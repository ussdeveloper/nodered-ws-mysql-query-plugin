<!--
MIEJSCE DO OPISANIA INTERFEJSU UŻYTKOWNIKA:
Ten plik HTML definiuje interfejs konfiguracyjny dla node'a MySQL Query w Node-RED.
Zawiera formularze do wprowadzania danych połączenia z bazą danych oraz zapytań SQL.

Sekcje interfejsu:
1. Konfiguracja połączenia z bazą danych
2. Pole zapytania SQL
3. Opcje zaawansowane
4. Pomoc i dokumentacja
-->

<script type="text/javascript">
    RED.nodes.registerType('mysql-query', {
        category: 'database',
        color: '#4B8BBE',
        defaults: {
            name: { value: "" },
            host: { value: "localhost", required: true },
            port: { value: 3306, required: true, validate: RED.validators.number() },
            user: { value: "", required: true },
            password: { value: "", required: true },
            database: { value: "", required: true },
            query: { value: "SELECT * FROM table_name LIMIT 10" }
        },
        inputs: 1,
        outputs: 1,
        icon: "db.png",
        label: function() {
            return this.name || "MySQL Query";
        },
        labelStyle: function() {
            return this.name ? "node_label_italic" : "";
        },
        /**
         * MIEJSCE DO OPISANIA WALIDACJI:
         * Funkcja oneditprepare jest wywoływana przy otwieraniu okna edycji.
         * Tutaj można dodać dodatkową logikę walidacji i inicjalizacji interfejsu.
         */
        oneditprepare: function() {
            // Inicjalizacja edytora SQL z podświetlaniem składni
            this.editor = RED.editor.createEditor({
                id: 'node-input-query-editor',
                mode: 'ace/mode/sql',
                value: this.query || "SELECT * FROM table_name LIMIT 10"
            });
        },
        /**
         * MIEJSCE DO OPISANIA ZAPISYWANIA KONFIGURACJI:
         * Funkcja oneditsave jest wywoływana przy zapisywaniu konfiguracji node'a.
         */
        oneditsave: function() {
            this.query = this.editor.getValue();
            this.editor.destroy();
            delete this.editor;
        },
        /**
         * MIEJSCE DO OPISANIA ANULOWANIA EDYCJI:
         * Funkcja oneditcancel jest wywoływana przy anulowaniu edycji.
         */
        oneditcancel: function() {
            this.editor.destroy();
            delete this.editor;
        }
    });
</script>

<!-- 
MIEJSCE DO OPISANIA SZABLONU HTML:
Poniższy szablon definiuje pola formularza konfiguracyjnego.
Każde pole odpowiada właściwości zdefiniowanej w obiekcie 'defaults' powyżej.
-->
<script type="text/html" data-template-name="mysql-query">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Nazwa</label>
        <input type="text" id="node-input-name" placeholder="Nazwa node'a">
    </div>
    
    <div class="form-row">
        <label for="node-input-host"><i class="fa fa-server"></i> Host</label>
        <input type="text" id="node-input-host" placeholder="localhost">
    </div>
    
    <div class="form-row">
        <label for="node-input-port"><i class="fa fa-plug"></i> Port</label>
        <input type="number" id="node-input-port" placeholder="3306">
    </div>
    
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-user"></i> Użytkownik</label>
        <input type="text" id="node-input-user" placeholder="root">
    </div>
    
    <div class="form-row">
        <label for="node-input-password"><i class="fa fa-lock"></i> Hasło</label>
        <input type="password" id="node-input-password">
    </div>
    
    <div class="form-row">
        <label for="node-input-database"><i class="fa fa-database"></i> Baza danych</label>
        <input type="text" id="node-input-database" placeholder="nazwa_bazy">
    </div>
    
    <div class="form-row" style="height: 250px;">
        <label for="node-input-query-editor"><i class="fa fa-code"></i> Zapytanie SQL</label>
        <div id="node-input-query-editor" style="height: 200px;"></div>
    </div>
</script>

<!-- 
MIEJSCE DO OPISANIA DOKUMENTACJI HELP:
Ta sekcja zawiera dokumentację która będzie wyświetlana w panelu pomocy Node-RED.
Opisuje funkcjonalność, parametry wejściowe i wyjściowe oraz przykłady użycia.
-->
<script type="text/html" data-help-name="mysql-query">
    <p>Node do wykonywania zapytań SQL w bazie danych MySQL.</p>
    
    <h3>Wejście</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">any</span></dt>
        <dd>Dowolne dane wejściowe (opcjonalne)</dd>
        
        <dt class="optional">query <span class="property-type">string</span></dt>
        <dd>Zapytanie SQL do wykonania (nadpisuje konfigurację)</dd>
        
        <dt class="optional">params <span class="property-type">array</span></dt>
        <dd>Parametry do zapytania SQL (dla prepared statements)</dd>
    </dl>
    
    <h3>Wyjście</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">array</span></dt>
        <dd>Wyniki zapytania jako tablica obiektów</dd>
        
        <dt>fields <span class="property-type">array</span></dt>
        <dd>Informacje o polach wyniku</dd>
        
        <dt>rowCount <span class="property-type">number</span></dt>
        <dd>Liczba zwróconych rekordów</dd>
    </dl>
    
    <h3>Szczegóły</h3>
    <p>Ten node pozwala na wykonywanie zapytań SQL do bazy danych MySQL. 
    Obsługuje zarówno zapytania skonfigurowane w node'ie, jak i zapytania przekazywane 
    dynamicznie przez właściwość <code>msg.query</code>.</p>
    
    <p>Parametry połączenia z bazą danych są konfigurowane w interfejsie node'a.</p>
    
    <h3>Przykład użycia</h3>
    <p>Aby wykonać zapytanie SELECT:</p>
    <pre>msg.query = "SELECT * FROM users WHERE active = ?";
msg.params = [1];
return msg;</pre>
    
    <h3>Bezpieczeństwo</h3>
    <p><strong>Uwaga:</strong> Zawsze używaj parametryzowanych zapytań (prepared statements) 
    aby uniknąć ataków SQL Injection. Użyj właściwości <code>msg.params</code> 
    do przekazywania parametrów.</p>
</script>
